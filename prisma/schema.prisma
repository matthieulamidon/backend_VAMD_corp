// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// npx prisma migrate dev --name init sur votre machine pour mettre a jours la BDD sur votre machine
// npx prisma migrate deploy en prode sur la CLI

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ========================= ENUMS =========================

enum JeuxEquipe {
  LEAGUEOFLEGENDES
  VALORANT
  FORTNITE
}

enum Poste {
  FORTNITE // IL N'y a pas de roles car ce jeu manque de stratégie  
  TOPLANER // LOL
  MIDLANER // LOL
  BOTLANER // LOL
  JUNGLER // LOL
  SUPORT // LOL
  DUELISTS // VALO
  SENTINELS // VALO
  INITIATORS // VALO
  CONTROLLERS // VALO 
  POLYVALENT // VALO il y a quatre roles dans valo mais 5 joueur dont un qui change de role en fonction de la map
}

enum SousRole {
  TITULAIRE
  REMPLACANT
  COACH
  CHEFDEQUIPE
  INSCRIPTION // dans le process d'INSCRIPTION il seul le coach le voie
}

enum DroitEnum {
  ADMIN
  COACH
  JOUEUR
  USER
}

enum SexeEnum {
  HOMME
  FEMME
  AUTRE
}

enum Icone {
  AVATAR1
  AVATAR2
  AVATAR3
}

// ========================= MODELS =========================

// ---- TABLE User ----
model User {
  id_user        Int       @id @default(autoincrement())
  nom            String?
  prenom         String?
  date_naissance DateTime
  email          String    @unique
  password       String
  sexe           SexeEnum?
  pseudo         String    @unique
  id_droit       Int?
  icone          Icone     @default(AVATAR1)
  description    String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  droit                Droit?          @relation(fields: [id_droit], references: [id_droit])
  participations       Participation[]
  userEquipes          UserEquipe[]
  evenements           Evenement[]     @relation("EvenementCoach")
  commentairesCoachees Commentaire[]   @relation("CoachCommentaires")
  commentairesJouees   Commentaire[]   @relation("JoueurCommentaires")

  @@map("user")
}

// ---- TABLE Droit ----
model Droit {
  id_droit Int       @id @default(autoincrement())
  droit    DroitEnum
  id_event Int?

  // Relations
  event Evenement? @relation(fields: [id_event], references: [id_event])
  users User[]

  @@map("droit")
}

// ---- TABLE Equipe ----
model Equipe {
  id_equipe    Int        @id @default(autoincrement())
  nom_equipe   String     @unique
  jeux_equipe  JeuxEquipe
  score_equipe Int?

  // Relations
  userEquipes         UserEquipe[]
  participationEquipe ParticipationEquipe[]

  @@map("equipe")
}

// ---- TABLE User_Equipe (association User ↔ Equipe) ----
model UserEquipe {
  id_user   Int
  id_equipe Int
  poste     Poste
  sous_role SousRole?

  // Relations
  user   User   @relation(fields: [id_user], references: [id_user])
  equipe Equipe @relation(fields: [id_equipe], references: [id_equipe])

  @@id([id_user, id_equipe])
  @@map("user_equipe")
}

// ---- TABLE Evenement ----
model Evenement {
  id_event         Int      @id @default(autoincrement())
  type_event       String
  date_heure_debut DateTime
  date_heure_fin   DateTime
  lieu             String
  description      String?
  titre_event      String
  id_user          Int?

  // Relations
  coach               User?                 @relation("EvenementCoach", fields: [id_user], references: [id_user])
  droits              Droit[]
  participations      Participation[]
  participationEquipe ParticipationEquipe[]
  commentaires        Commentaire[]         @relation("EvenementCommentaires")

  @@map("evenement")
}

model GrandEvenement {
  id               Int      @id @default(autoincrement())
  titre            String
  type_event       String
  date_heure_debut DateTime
  date_heure_fin   DateTime
  lieu             String?
  description      String?
  org_logo         String?
  game_logo        String?
  prize            String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

// ---- TABLE Participation (User ↔ Evenement) ----
model Participation {
  id_event Int
  id_user  Int
  droit    DroitEnum

  // Relations
  user  User      @relation(fields: [id_user], references: [id_user])
  event Evenement @relation(fields: [id_event], references: [id_event])

  @@id([id_event, id_user])
  @@map("participation")
}

// ---- TABLE Participation_Equipe (Equipe ↔ Evenement) ----
model ParticipationEquipe {
  id_equipe Int
  id_event  Int

  // Relations
  equipe Equipe    @relation(fields: [id_equipe], references: [id_equipe])
  event  Evenement @relation(fields: [id_event], references: [id_event])

  @@id([id_equipe, id_event])
  @@map("participation_equipe")
}

model Commentaire {
  id_commentaire   Int      @id @default(autoincrement())
  id_coach         Int
  id_joueur        Int
  id_event         Int?
  kds              String
  presence         Boolean  @default(true)
  date_commentaire DateTime @default(now())

  coach  User       @relation("CoachCommentaires", fields: [id_coach], references: [id_user])
  joueur User       @relation("JoueurCommentaires", fields: [id_joueur], references: [id_user])
  event  Evenement? @relation("EvenementCommentaires", fields: [id_event], references: [id_event])

  @@map("commentaire")
}
